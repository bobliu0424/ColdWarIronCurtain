#新政治局系统
PRC_CCCPC_gui_update = {
	clear_array = PRC_CCCPC_leaders_influence_gui_array
	for_each_loop = {
        array = PRC_CCCPC_leaders_array
        index = temp_i
        
		set_temp_variable = { PRC_CCCPC_leaders_influence_temp = PRC_CCCPC_leaders_influence_array^temp_i }
        round_temp_variable = PRC_CCCPC_leaders_influence_temp
         
		for_loop_effect = {
			start = 0
			end = PRC_CCCPC_leaders_influence_temp
            
			add_to_array = { PRC_CCCPC_leaders_influence_gui_array = PRC_CCCPC_leaders_array^temp_i }
        }
    }
}
PRC_CCCPC_leaders_influence_update = {
	custom_effect_tooltip = PRC_CCCPC_leaders_influence_change_tt
	for_each_loop = {
        array = PRC_CCCPC_leaders_array
        index = temp_i
		value = temp_v2
        
		if = {
			limit = {
				check_variable = { temp_v2 = temp_v }
			}
			add_to_variable = {
				var =  PRC_CCCPC_leaders_influence_array^temp_i 
				value = temp_influence
			}
		}
    }
    PRC_CCCPC_gui_update = yes
}
PRC_CCCPC_party_status_update = {
     #party status#
	set_variable = { PRC_CPC_political_power_gain = 0 }
	set_variable = { PRC_CPC_stability_factor = 0 }
	set_variable = { PRC_CPC_drift_defence_factor = 0 }

	set_temp_variable = { temp_status1 = PRC_party_unity }#
	subtract_from_temp_variable = { temp_status1 = 60 }
	set_temp_variable = { temp_status2 = temp_status1 }
	if = {
		limit = { check_variable = { temp_status2 < 0 } }
		multiply_temp_variable = { temp_status2 = -1 }
	}
	add_to_temp_variable = { temp_status2 = 40 }
	divide_temp_variable = { temp_status1 = temp_status2 }
    
	multiply_temp_variable = { temp_status1 = 0.6 }#
	add_to_variable = { PRC_CPC_political_power_gain = temp_status1 }
	divide_temp_variable = { temp_status1 = 0.6 }
	multiply_temp_variable = { temp_status1 = 0.3 }
	add_to_variable = { PRC_CPC_stability_factor = temp_status1 }
	divide_temp_variable = { temp_status1 = 0.3 }
	add_to_variable = { PRC_CPC_drift_defence_factor = temp_status1 }

	set_temp_variable = { temp_status1 = PRC_party_discipline }#
	subtract_from_temp_variable = { temp_status1 = 60 }
	set_temp_variable = { temp_status2 = temp_status1 }
	if = {
		limit = { check_variable = { temp_status2 < 0 } }
		multiply_temp_variable = { temp_status2 = -1 }
	}
	add_to_temp_variable = { temp_status2 = 40 }
	divide_temp_variable = { temp_status1 = temp_status2 }
      
	multiply_temp_variable = { temp_status1 = 0.6 }#
	add_to_variable = { PRC_CPC_political_power_gain = temp_status1 }
	divide_temp_variable = { temp_status1 = 0.6 }
	multiply_temp_variable = { temp_status1 = 0.2 }
	add_to_variable = { PRC_CPC_stability_factor = temp_status1 }

	force_update_dynamic_modifier = yes
}
PRC_CCCPC_gui_startup = {
	set_country_flag = PRC_Seventh_Central_Committee_of_CPC

	clear_array = PRC_CCCPC_leaders_array
	clear_array = PRC_CCCPC_Political_Bureau_array
	clear_array = PRC_CCCPC_leaders_influence_array

	add_to_array = { PRC_CCCPC_leaders_array = 1 }
	add_to_array = { PRC_CCCPC_leaders_array = 2 }
	add_to_array = { PRC_CCCPC_leaders_array = 3 }
	add_to_array = { PRC_CCCPC_leaders_array = 4 }
	
	add_to_array = { PRC_CCCPC_Political_Bureau_array = 1 }
	add_to_array = { PRC_CCCPC_Political_Bureau_array = 2 }
	add_to_array = { PRC_CCCPC_Political_Bureau_array = 3 }
	add_to_array = { PRC_CCCPC_Political_Bureau_array = 4 }
	add_to_array = { PRC_CCCPC_Political_Bureau_array = 5 }
	add_to_array = { PRC_CCCPC_Political_Bureau_array = 6 }
	add_to_array = { PRC_CCCPC_Political_Bureau_array = 7 }
	add_to_array = { PRC_CCCPC_Political_Bureau_array = 8 }
	add_to_array = { PRC_CCCPC_Political_Bureau_array = 9 }
	add_to_array = { PRC_CCCPC_Political_Bureau_array = 10 }
	add_to_array = { PRC_CCCPC_Political_Bureau_array = 11 }
	add_to_array = { PRC_CCCPC_Political_Bureau_array = 12 }
	add_to_array = { PRC_CCCPC_Political_Bureau_array = 13 }
	#add_to_array = { PRC_CCCPC_Political_Bureau_array = 14 }
	#add_to_array = { PRC_CCCPC_Political_Bureau_array = 15 }

	add_to_array = { PRC_CCCPC_leaders_influence_array = 48.2 }
	add_to_array = { PRC_CCCPC_leaders_influence_array = 21 }
	add_to_array = { PRC_CCCPC_leaders_influence_array = 25.7 }
	add_to_array = { PRC_CCCPC_leaders_influence_array = 5.1 }

	set_variable = { PRC_party_discipline = 92 }
	set_variable = { PRC_party_unity = 90 }

	PRC_CCCPC_gui_update = yes

	PRC_CCCPC_party_status_update = yes
}
#旧政治局系统
PRC_faction_struggle_system_startup = {
    clear_array = PRC_faction_struggle_system_faction_influence

    add_to_array = { PRC_faction_struggle_system_faction_influence = 29 }
    add_to_array = { PRC_faction_struggle_system_faction_influence = 14 }
    add_to_array = { PRC_faction_struggle_system_faction_influence = 49 }
    add_to_array = { PRC_faction_struggle_system_faction_influence = 4 }
    add_to_array = { PRC_faction_struggle_system_faction_influence = 4 }

    clear_array = PRC_faction_struggle_system_faction_party_support
    clear_array = PRC_faction_struggle_system_faction_gov_support
    clear_array = PRC_faction_struggle_system_faction_army_support

    add_to_array = { PRC_faction_struggle_system_faction_party_support = 29 }
    add_to_array = { PRC_faction_struggle_system_faction_party_support = 14 }
    add_to_array = { PRC_faction_struggle_system_faction_party_support = 49 }
    add_to_array = { PRC_faction_struggle_system_faction_party_support = 4 }
    add_to_array = { PRC_faction_struggle_system_faction_party_support = 4 }

    add_to_array = { PRC_faction_struggle_system_faction_gov_support = 39 }
    add_to_array = { PRC_faction_struggle_system_faction_gov_support = 4 }
    add_to_array = { PRC_faction_struggle_system_faction_gov_support = 49 }
    add_to_array = { PRC_faction_struggle_system_faction_gov_support = 4 }
    add_to_array = { PRC_faction_struggle_system_faction_gov_support = 4 }

    add_to_array = { PRC_faction_struggle_system_faction_army_support = 0 }
    add_to_array = { PRC_faction_struggle_system_faction_army_support = 40 }
    add_to_array = { PRC_faction_struggle_system_faction_army_support = 50 }
    add_to_array = { PRC_faction_struggle_system_faction_army_support = 10 }
    add_to_array = { PRC_faction_struggle_system_faction_army_support = 0 }

    set_variable = { PRC_faction_struggle_system_party_united = 85 }
    set_variable = { PRC_faction_struggle_system_party_discipline = 90 }

    PRC_faction_struggle_system_gui_reflesh = yes

    clear_array = PRC_faction_struggle_system_faction_supporter_0
    clear_array = PRC_faction_struggle_system_faction_supporter_1
    clear_array = PRC_faction_struggle_system_faction_supporter_2
    clear_array = PRC_faction_struggle_system_faction_supporter_3
    clear_array = PRC_faction_struggle_system_faction_supporter_4

    add_to_array = { PRC_faction_struggle_system_faction_supporter_1 = 0 }
    add_to_array = { PRC_faction_struggle_system_faction_supporter_1 = 1 }
    add_to_array = { PRC_faction_struggle_system_faction_supporter_1 = 2 }

    add_to_array = { PRC_faction_struggle_system_faction_supporter_2 = 3 }

    add_to_array = { PRC_faction_struggle_system_faction_supporter_4 = 5 }
    add_to_array = { PRC_faction_struggle_system_faction_supporter_4 = 6 }
    add_to_array = { PRC_faction_struggle_system_faction_supporter_4 = 7 }

    clear_array = PRC_faction_struggle_system_faction_supporter_effect

    resize_array = {
		array = PRC_faction_struggle_system_faction_supporter_effect
		value = 0.1
		size = 9
	}

    PRC_faction_struggle_system_faction_supporter_effect_reflesh = yes
}

PRC_faction_struggle_system_gui_reflesh = {
    clear_array = PRC_faction_struggle_system_faction_party_support_frame
    clear_array = PRC_faction_struggle_system_faction_gov_support_frame
    clear_array = PRC_faction_struggle_system_faction_army_support_frame

    resize_array = {
		array = PRC_faction_struggle_system_faction_party_support_frame
		value = 0
		size = 5
	}
    resize_array = {
		array = PRC_faction_struggle_system_faction_gov_support_frame
		value = 0
		size = 5
	}
    resize_array = {
		array = PRC_faction_struggle_system_faction_army_support_frame
		value = 0
		size = 5
	}

    for_each_loop = {
        array = PRC_faction_struggle_system_faction_party_support
        index = index_y

        set_temp_variable = { index_x = index_y }
        add_to_temp_variable = { index_x = 1 }

        for_loop_effect = {
            start = 0
            end = index_x
            value = i

            add_to_variable = { PRC_faction_struggle_system_faction_party_support_frame^i = PRC_faction_struggle_system_faction_party_support^index_y }
        }
    }

    for_each_loop = {
        array = PRC_faction_struggle_system_faction_gov_support
        index = index_y

        set_temp_variable = { index_x = index_y }
        add_to_temp_variable = { index_x = 1 }

        for_loop_effect = {
            start = 0
            end = index_x
            value = i

            add_to_variable = { PRC_faction_struggle_system_faction_gov_support_frame^i = PRC_faction_struggle_system_faction_gov_support^index_y }
        }
    }

    for_each_loop = {
        array = PRC_faction_struggle_system_faction_army_support
        index = index_y

        set_temp_variable = { index_x = index_y }
        add_to_temp_variable = { index_x = 1 }

        for_loop_effect = {
            start = 0
            end = index_x
            value = i

            add_to_variable = { PRC_faction_struggle_system_faction_army_support_frame^i = PRC_faction_struggle_system_faction_army_support^index_y }
        }
    }
}

PRC_faction_struggle_system_faction_influence_change = {

    custom_effect_tooltip = PRC_faction_struggle_system_faction_influence_change

    if = {
        limit = {
            set_temp_variable = { check = temp_y }
            add_to_temp_variable = { check = PRC_faction_struggle_system_faction_influence^temp_x }
            check_variable = { check < 100 }
            check_variable = { check > 0 }
        }

        set_temp_variable = { temp_t = 100 }
        subtract_from_temp_variable = { temp_t = temp_y }
        subtract_from_temp_variable = { temp_t = PRC_faction_struggle_system_faction_influence^temp_x }
    
        multiply_temp_variable = { temp_y = 100 }
        divide_temp_variable = { temp_y = temp_t }
    
        add_to_variable = { PRC_faction_struggle_system_faction_influence^temp_x = temp_y }
    
        set_temp_variable = { temp_t = 0 }
        for_each_loop = {
            array = PRC_faction_struggle_system_faction_influence
            value = v
    
            add_to_temp_variable = { temp_t = v }
        }
        for_each_loop = {
            array = PRC_faction_struggle_system_faction_influence
            index = i
    
            divide_variable = { PRC_faction_struggle_system_faction_influence^i = temp_t }
            multiply_variable = { PRC_faction_struggle_system_faction_influence^i = 100 }
        }
    }
    else_if = {
        limit = {
            set_temp_variable = { check = temp_y }
            add_to_temp_variable = { check = PRC_faction_struggle_system_faction_influence^temp_x }
            NOT = { check_variable = { check < 100 } }
        }
        for_each_loop = {
            array = PRC_faction_struggle_system_faction_influence
            index = i
    
            set_variable = { PRC_faction_struggle_system_faction_influence^i = 0 }
        }
        set_variable = { PRC_faction_struggle_system_faction_influence^temp_x = 100 }
    }
    else_if = {
        limit = {
            set_temp_variable = { check = temp_y }
            add_to_temp_variable = { check = PRC_faction_struggle_system_faction_influence^temp_x }
            NOT = { check_variable = { check > 0 } }
        }
        set_variable = { PRC_faction_struggle_system_faction_influence^temp_x = 0 }
        set_temp_variable = { temp_t = 0 }
        for_each_loop = {
            array = PRC_faction_struggle_system_faction_influence
            value = v
    
            add_to_temp_variable = { temp_t = v }
        }
        for_each_loop = {
            array = PRC_faction_struggle_system_faction_influence
            index = i
    
            divide_variable = { PRC_faction_struggle_system_faction_influence^i = temp_t }
            multiply_variable = { PRC_faction_struggle_system_faction_influence^i = 100 }
        }
    }

    

    PRC_faction_struggle_system_gui_reflesh = yes
}

PRC_faction_struggle_system_faction_support_change = {

    custom_effect_tooltip = PRC_faction_struggle_system_faction_support_change

    if = {
        limit = {
            check_variable = { temp_z = 0 }
        }
        set_temp_variable = { check = PRC_faction_struggle_system_faction_party_support^temp_x }
        add_to_temp_variable = { check = temp_y }
    }
    else_if = {
        limit = {
            check_variable = { temp_z = 1 }
        }
        set_temp_variable = { check = PRC_faction_struggle_system_faction_gov_support^temp_x }
        add_to_temp_variable = { check = temp_y }
    }
    else_if = {
        limit = {
            check_variable = { temp_z = 2 }
        }
        set_temp_variable = { check = PRC_faction_struggle_system_faction_army_support^temp_x }
        add_to_temp_variable = { check = temp_y }
    }

    if = {
        limit = {
            check_variable = { check < 100 }
            check_variable = { check > 0 }
        }

        set_temp_variable = { temp_t = 100 }
        subtract_from_temp_variable = { temp_t = temp_y }
        if = {
            limit = {
                check_variable = { temp_z = 0 }
            }
            subtract_from_temp_variable = { temp_t = PRC_faction_struggle_system_faction_party_support^temp_x }
        }
        else_if = {
            limit = {
                check_variable = { temp_z = 1 }
            }
            subtract_from_temp_variable = { temp_t = PRC_faction_struggle_system_faction_gov_support^temp_x }
        }
        else_if = {
            limit = {
                check_variable = { temp_z = 2 }
            }
            subtract_from_temp_variable = { temp_t = PRC_faction_struggle_system_faction_army_support^temp_x }
        }
    
        multiply_temp_variable = { temp_y = 100 }
        divide_temp_variable = { temp_y = temp_t }
    
        if = {
            limit = {
                check_variable = { temp_z = 0 }
            }
            add_to_variable = { PRC_faction_struggle_system_faction_party_support^temp_x = temp_y }
        }
        else_if = {
            limit = {
                check_variable = { temp_z = 1 }
            }
            add_to_variable = { PRC_faction_struggle_system_faction_gov_support^temp_x = temp_y }
        }
        else_if = {
            limit = {
                check_variable = { temp_z = 2 }
            }
            add_to_variable = { PRC_faction_struggle_system_faction_army_support^temp_x = temp_y }
        }
    
        set_temp_variable = { temp_t = 0 }
    
        if = {
            limit = {
                check_variable = { temp_z = 0 }
            }
            for_each_loop = {
                array = PRC_faction_struggle_system_faction_party_support
                value = v
        
                add_to_temp_variable = { temp_t = v }
            }
            for_each_loop = {
                array = PRC_faction_struggle_system_faction_party_support
                index = i
        
                divide_variable = { PRC_faction_struggle_system_faction_party_support^i = temp_t }
                multiply_variable = { PRC_faction_struggle_system_faction_party_support^i = 100 }
            }
        }
        else_if = {
            limit = {
                check_variable = { temp_z = 1 }
            }
            for_each_loop = {
                array = PRC_faction_struggle_system_faction_gov_support
                value = v
        
                add_to_temp_variable = { temp_t = v }
            }
            for_each_loop = {
                array = PRC_faction_struggle_system_faction_gov_support
                index = i
        
                divide_variable = { PRC_faction_struggle_system_faction_gov_support^i = temp_t }
                multiply_variable = { PRC_faction_struggle_system_faction_gov_support^i = 100 }
            }
        }
        else_if = {
            limit = {
                check_variable = { temp_z = 2 }
            }
            for_each_loop = {
                array = PRC_faction_struggle_system_faction_army_support
                value = v
        
                add_to_temp_variable = { temp_t = v }
            }
            for_each_loop = {
                array = PRC_faction_struggle_system_faction_army_support
                index = i
        
                divide_variable = { PRC_faction_struggle_system_faction_army_support^i = temp_t }
                multiply_variable = { PRC_faction_struggle_system_faction_army_support^i = 100 }
            }
        }
    }
    else_if = {
        limit = {
            NOT = { check_variable = { check < 100 } }
        }

        if = {
            limit = {
                check_variable = { temp_z = 0 }
            }
            for_each_loop = {
                array = PRC_faction_struggle_system_faction_party_support
                index = i
        
                set_variable = { PRC_faction_struggle_system_faction_party_support^i = 0 }
            }
        }
        else_if = {
            limit = {
                check_variable = { temp_z = 1 }
            }
            for_each_loop = {
                array = PRC_faction_struggle_system_faction_gov_support
                index = i
        
                set_variable = { PRC_faction_struggle_system_faction_gov_support^i = 0 }
            }
        }
        else_if = {
            limit = {
                check_variable = { temp_z = 2 }
            }
            for_each_loop = {
                array = PRC_faction_struggle_system_faction_army_support
                index = i
        
                set_variable = { PRC_faction_struggle_system_faction_army_support^i = 0 }
            }
        }

        if = {
            limit = {
                check_variable = { temp_z = 0 }
            }
            set_variable = { PRC_faction_struggle_system_faction_party_support^temp_x = 100 }
        }
        else_if = {
            limit = {
                check_variable = { temp_z = 1 }
            }
            set_variable = { PRC_faction_struggle_system_faction_gov_support^temp_x = 100 }
        }
        else_if = {
            limit = {
                check_variable = { temp_z = 2 }
            }
            set_variable = { PRC_faction_struggle_system_faction_army_support^temp_x = 100 }
        }
    }
    else_if = {
        limit = {
            NOT = { check_variable = { check > 0 } }
        }

        if = {
            limit = {
                check_variable = { temp_z = 0 }
            }
            set_variable = { PRC_faction_struggle_system_faction_party_support^temp_x = 0 }
        }
        else_if = {
            limit = {
                check_variable = { temp_z = 1 }
            }
            set_variable = { PRC_faction_struggle_system_faction_gov_support^temp_x = 0 }
        }
        else_if = {
            limit = {
                check_variable = { temp_z = 2 }
            }
            set_variable = { PRC_faction_struggle_system_faction_army_support^temp_x = 0 }
        }
    
        set_temp_variable = { temp_t = 0 }
    
        if = {
            limit = {
                check_variable = { temp_z = 0 }
            }
            for_each_loop = {
                array = PRC_faction_struggle_system_faction_party_support
                value = v
        
                add_to_temp_variable = { temp_t = v }
            }
            for_each_loop = {
                array = PRC_faction_struggle_system_faction_party_support
                index = i
        
                divide_variable = { PRC_faction_struggle_system_faction_party_support^i = temp_t }
                multiply_variable = { PRC_faction_struggle_system_faction_party_support^i = 100 }
            }
        }
        else_if = {
            limit = {
                check_variable = { temp_z = 1 }
            }
            for_each_loop = {
                array = PRC_faction_struggle_system_faction_gov_support
                value = v
        
                add_to_temp_variable = { temp_t = v }
            }
            for_each_loop = {
                array = PRC_faction_struggle_system_faction_gov_support
                index = i
        
                divide_variable = { PRC_faction_struggle_system_faction_gov_support^i = temp_t }
                multiply_variable = { PRC_faction_struggle_system_faction_gov_support^i = 100 }
            }
        }
        else_if = {
            limit = {
                check_variable = { temp_z = 2 }
            }
            for_each_loop = {
                array = PRC_faction_struggle_system_faction_army_support
                value = v
        
                add_to_temp_variable = { temp_t = v }
            }
            for_each_loop = {
                array = PRC_faction_struggle_system_faction_army_support
                index = i
        
                divide_variable = { PRC_faction_struggle_system_faction_army_support^i = temp_t }
                multiply_variable = { PRC_faction_struggle_system_faction_army_support^i = 100 }
            }
        }
    }

    PRC_faction_struggle_system_gui_reflesh = yes
}

PRC_faction_struggle_system_faction_var_change = {
    if = {
        limit = {
            check_variable = { temp_x = 0 }
        }
        add_to_variable = { PRC_faction_struggle_system_party_united = temp_y }
    }
    else_if = {
        limit = {
            check_variable = { temp_x = 1 }
        }
        add_to_variable = { PRC_faction_struggle_system_party_discipline = temp_y }
    }

    clamp_variable = {
		var = PRC_faction_struggle_system_party_united
		min = 0
		max = 100
	}
    clamp_variable = {
		var = PRC_faction_struggle_system_party_discipline
		min = 0
		max = 100
	}
    
    custom_effect_tooltip = PRC_faction_struggle_system_faction_var_change
}

PRC_faction_struggle_system_faction_supporter_change = {
    if = {
        limit = {
            check_variable = { temp_y = 0 }
        }
        if = {
            limit = {
                meta_trigger = {
                    text = {
                        is_in_array = {
                            PRC_faction_struggle_system_faction_supporter_[x] = temp_i
                        }
                    }
                    x = "[?temp_x]"
                }
            }
            meta_effect = {
                text = {
                    remove_from_array = {
                        array = PRC_faction_struggle_system_faction_supporter_[x]
	                    value = temp_i
                    }
                }
                x = "[?temp_x]"
            }
        }
        custom_effect_tooltip = PRC_faction_struggle_system_faction_supporter_remove
    }
    else_if = {
        limit = {
            check_variable = { temp_y = 1 }
        }
        if = {
            limit = {
                NOT = {
                    meta_trigger = {
                        text = {
                            is_in_array = {
                                PRC_faction_struggle_system_faction_supporter_[x] = temp_i
                            }
                        }
                        x = "[?temp_x]"
                    }
                }
            }
            meta_effect = {
                text = {
                    add_to_array = {
                        array = PRC_faction_struggle_system_faction_supporter_[x]
	                    value = temp_i
                    }
                }
                x = "[?temp_x]"
            }
            custom_effect_tooltip = PRC_faction_struggle_system_faction_supporter_add
        }
    }

    PRC_faction_struggle_system_faction_supporter_effect_reflesh = yes
}

PRC_faction_struggle_system_faction_supporter_effect_reflesh = {
    clear_array = PRC_faction_struggle_system_faction_supporter_feffect

    for_loop_effect = {
        start = 0 
        end = 5
        value = v

        add_to_array = { PRC_faction_struggle_system_faction_supporter_feffect = 0 }

        meta_effect = {
            text = {
                for_each_loop = {
                    array = PRC_faction_struggle_system_faction_supporter_[x]
                    value = index

                    add_to_variable = { PRC_faction_struggle_system_faction_supporter_feffect^v = PRC_faction_struggle_system_faction_supporter_effect^index }
                }
            }
            x = "[?v]"
        }
    }
}

PRC_faction_struggle_system_faction_supporter_effect_change = {
    add_to_variable = { PRC_faction_struggle_system_faction_supporter_effect^temp_i = temp_y }

    custom_effect_tooltip = PRC_faction_struggle_system_faction_supporter_effect_change
    PRC_faction_struggle_system_faction_supporter_effect_reflesh = yes
}


##社会阶级                    #态度(-50-50)      #权重(0-100)
# 1 - Senior Cadre              
# 2 - Lower Cadre
# 3 - Military Officer
# 4 - Soldier
# 5 - Landlord Rich Peasant
# 6 - Middle Peasant
# 7 - Poor Peasant
# 8 - Comprador Bourgeoisie
# 9 - National Bourgeoisie
# 10 - Petty Bourgeoisie
# 11 - Intellectual
# 12 - Senior Worker
# 13 - Middle Lower Worker
# 14 - Priest
# 15 - Red Nobility
# 16 - Entrepreneur
PRC_Social_Class_startup = {
	clear_array = PRC_major_class_array
	clear_array = PRC_major_class_weight_array
	clear_array = PRC_major_class_attitude_array
	clear_array = PRC_general_class_array
	clear_array = PRC_general_class_weight_array
	clear_array = PRC_general_class_attitude_array
	clear_array = PRC_marginal_class_array
	clear_array = PRC_marginal_class_weight_array
	clear_array = PRC_marginal_class_attitude_array

	add_to_array = { PRC_major_class_array = 1 }
	add_to_array = { PRC_major_class_weight_array = 0 }
	add_to_array = { PRC_major_class_attitude_array = 0 }
	add_to_array = { PRC_major_class_array = 2 }
	add_to_array = { PRC_major_class_weight_array = 0 }
	add_to_array = { PRC_major_class_attitude_array = 0 }
	add_to_array = { PRC_major_class_array = 3 }
	add_to_array = { PRC_major_class_weight_array = 0 }
	add_to_array = { PRC_major_class_attitude_array = 0 }
	add_to_array = { PRC_major_class_array = 5 }
	add_to_array = { PRC_major_class_weight_array = 0 }
	add_to_array = { PRC_major_class_attitude_array = 0 }
	add_to_array = { PRC_general_class_array = 4 }
	add_to_array = { PRC_general_class_weight_array = 0 }
	add_to_array = { PRC_general_class_attitude_array = 0 }
	add_to_array = { PRC_general_class_array = 6 }
	add_to_array = { PRC_general_class_weight_array = 0 }
	add_to_array = { PRC_general_class_attitude_array = 0 }
	add_to_array = { PRC_general_class_array = 9 }
	add_to_array = { PRC_general_class_weight_array = 0 }
	add_to_array = { PRC_general_class_attitude_array = 0 }
	add_to_array = { PRC_general_class_array = 10 }
	add_to_array = { PRC_general_class_weight_array = 0 }
	add_to_array = { PRC_general_class_attitude_array = 0 }
	add_to_array = { PRC_general_class_array = 11 }
	add_to_array = { PRC_general_class_weight_array = 0 }
	add_to_array = { PRC_general_class_attitude_array = 0 }
	add_to_array = { PRC_general_class_array = 12 }
	add_to_array = { PRC_general_class_weight_array = 0 }
	add_to_array = { PRC_general_class_attitude_array = 0 }
	add_to_array = { PRC_marginal_class_array = 7 }
	add_to_array = { PRC_marginal_class_weight_array = 0 }
	add_to_array = { PRC_marginal_class_attitude_array = 0 }
	add_to_array = { PRC_marginal_class_array = 13 }
	add_to_array = { PRC_marginal_class_weight_array = 0 }
	add_to_array = { PRC_marginal_class_attitude_array = 0 }
}
PRC_Pop_Update_effect = {
	clear_array = PRC_Major_Pop
	clear_array = PRC_Ordinary_Pop
	clear_array = PRC_Marginalized_Pop
	clear_array = PRC_Major_Pop_Attitude
	clear_array = PRC_Major_Pop_Influence
	clear_array = PRC_Ordinary_Pop_Attitude
	clear_array = PRC_Ordinary_Pop_Influence
	clear_array = PRC_Marginalized_Pop_Attitude
	clear_array = PRC_Marginalized_Pop_Influence

	set_temp_variable = {
		PRC_Pop_temp = 1
	}
	set_temp_variable = {
		PRC_Pop_influence_total = 0
	}
	for_loop_effect = {
		start = 0
		end = 30		#数值等于可激活人群的最大序号
		if = {
			limit = {
				meta_trigger = {
					text = {
						has_country_flag = PRC_Major_Pop[PRC_Pop_Serial_Num1]_flag
					}
					PRC_Pop_Serial_Num1 = "[?PRC_Pop_temp]"
				}
			}
			add_to_array = {
				array = PRC_Major_Pop
				value = PRC_Pop_temp
			}
			meta_effect = {
				text = {
					clamp_variable = { 
						var = PRC_Pop[PRC_Pop_Serial_Num2]_Attitude
						max = 25
						min = -25
					}
					clamp_variable = { 
						var = PRC_Pop[PRC_Pop_Serial_Num2]_Influence
						min = 0
					}
					add_to_array = {
						array = PRC_Major_Pop_Attitude
						value = PRC_Pop[PRC_Pop_Serial_Num2]_Attitude
					}
					add_to_array = {
						array = PRC_Major_Pop_Influence
						value = PRC_Pop[PRC_Pop_Serial_Num2]_Influence
					}
					add_to_temp_variable = {
					    PRC_Pop_influence_total = PRC_Pop[PRC_Pop_Serial_Num2]_Influence
				    }
				}
				PRC_Pop_Serial_Num2 = "[?PRC_Pop_temp]"
			}
		}
		else_if = {
			limit = {
				meta_trigger = {
					text = {
						has_country_flag = PRC_Ordinary_Pop[PRC_Pop_Serial_Num1]_flag
					}
					PRC_Pop_Serial_Num1 = "[?PRC_Pop_temp]"
				}
			}
			add_to_array = {
				array = PRC_Ordinary_Pop
				value = PRC_Pop_temp
			}
			meta_effect = {
				text = {
					clamp_variable = { 
						var = PRC_Pop[PRC_Pop_Serial_Num2]_Attitude
						max = 25
						min = -25
					}
					clamp_variable = { 
						var = PRC_Pop[PRC_Pop_Serial_Num2]_Influence
						min = 0
					}
					add_to_array = {
						array = PRC_Ordinary_Pop_Attitude
						value = PRC_Pop[PRC_Pop_Serial_Num2]_Attitude
					}
					add_to_array = {
						array = PRC_Ordinary_Pop_Influence
						value = PRC_Pop[PRC_Pop_Serial_Num2]_Influence
					}
					add_to_temp_variable = {
					    PRC_Pop_influence_total = PRC_Pop[PRC_Pop_Serial_Num2]_Influence
				    }
				}
				PRC_Pop_Serial_Num2 = "[?PRC_Pop_temp]"
			}
		}
		else_if = {
			limit = {
				meta_trigger = {
					text = {
						has_country_flag = PRC_Marginalized_Pop[PRC_Pop_Serial_Num1]_flag
					}
					PRC_Pop_Serial_Num1 = "[?PRC_Pop_temp]"
				}
			}
			add_to_array = {
				array = PRC_Marginalized_Pop
				value = PRC_Pop_temp
			}
			meta_effect = {
				text = {
					clamp_variable = { 
						var = PRC_Pop[PRC_Pop_Serial_Num2]_Attitude
						max = 25
						min = -25
					}
					clamp_variable = { 
						var = PRC_Pop[PRC_Pop_Serial_Num2]_Influence
						min = 0
					}
					add_to_array = {
						array = PRC_Marginalized_Pop_Attitude
						value = PRC_Pop[PRC_Pop_Serial_Num2]_Attitude
					}
					add_to_array = {
						array = PRC_Marginalized_Pop_Influence
						value = PRC_Pop[PRC_Pop_Serial_Num2]_Influence
					}
					add_to_temp_variable = {
					    PRC_Pop_influence_total = PRC_Pop[PRC_Pop_Serial_Num2]_Influence
				    }
				}
				PRC_Pop_Serial_Num2 = "[?PRC_Pop_temp]"
			}
		}
		add_to_temp_variable = {
			PRC_Pop_temp = 1
		}
	}
	set_temp_variable = {
		PRC_Pop_temp = 1
	}
	set_variable = {
		PRC_Party_s_Authority_var = 0
	}
	for_loop_effect = {
		start = 0
		end = 30		#数值等于可激活人群的最大序号
		if = {
			limit = {
				meta_trigger = {
					text = {
						has_country_flag = PRC_Major_Pop[PRC_Pop_Serial_Num1]_flag
					}
					PRC_Pop_Serial_Num1 = "[?PRC_Pop_temp]"
				}
			}
			meta_effect = {
				text = {
					set_temp_variable = {
						PRC_Party_s_Authority_temp = PRC_Pop[PRC_Pop_Serial_Num2]_Attitude
					}
					add_to_temp_variable = {
						PRC_Party_s_Authority_temp = 50
					}
					divide_temp_variable = {
						PRC_Party_s_Authority_temp = 60
					}
					if = {
						limit = {
							check_variable = {
								var = PRC_Party_s_Authority_temp
								value = 1
								compare = greater_than
							}
						}
						set_temp_variable = {
							PRC_Party_s_Authority_temp = 1
						}
					}
					set_temp_variable = {
						PRC_Pop_Influence_temp = PRC_Pop[PRC_Pop_Serial_Num2]_Influence
					}
					divide_temp_variable = { PRC_Pop_Influence_temp = PRC_Pop_influence_total }
					multiply_temp_variable = {
						PRC_Party_s_Authority_temp = PRC_Pop_Influence_temp
					}
					add_to_variable = {
						PRC_Party_s_Authority_var = PRC_Party_s_Authority_temp
					}
				}
				PRC_Pop_Serial_Num2 = "[?PRC_Pop_temp]"
			}
		}
		add_to_temp_variable = {
			PRC_Pop_temp = 1
		}
	}
	set_variable = {
		PRC_Party_s_Authority_frame = PRC_Party_s_Authority_var
	}
	multiply_variable = {
		PRC_Party_s_Authority_frame = 100
	}
}
PRC_Pop_Unlock_effect = {
	set_country_flag = PRC_Pop_visible_flag

	set_country_flag = PRC_Major_Pop1_flag
	set_variable = {
		PRC_Pop1_Attitude = -20
	}
	set_variable = {
		PRC_Pop1_Influence = 64
	}
	set_country_flag = PRC_Major_Pop2_flag
	set_variable = {
		PRC_Pop2_Attitude = 30
	}
	set_variable = {
		PRC_Pop2_Influence = 76
	}
	set_country_flag = PRC_Major_Pop3_flag
	set_variable = {
		PRC_Pop3_Attitude = 30
	}
	set_variable = {
		PRC_Pop3_Influence = 64
	}
	set_country_flag = PRC_Ordinary_Pop4_flag
	set_variable = {
		PRC_Pop4_Attitude = -40
	}
	set_variable = {
		PRC_Pop4_Influence = 20
	}
	set_country_flag = PRC_Ordinary_Pop5_flag
	set_variable = {
		PRC_Pop5_Attitude = 0
	}
	set_variable = {
		PRC_Pop5_Influence = 40
	}
	set_country_flag = PRC_Ordinary_Pop6_flag
	set_variable = {
		PRC_Pop6_Attitude = -10
	}
	set_variable = {
		PRC_Pop6_Influence = 40
	}
	set_country_flag = PRC_Ordinary_Pop7_flag
	set_variable = {
		PRC_Pop7_Attitude = 20
	}
	set_variable = {
		PRC_Pop7_Influence = 52
	}
	set_country_flag = PRC_Ordinary_Pop8_flag
	set_variable = {
		PRC_Pop8_Attitude = 10
	}
	set_variable = {
		PRC_Pop8_Influence = 24
	}
	set_country_flag = PRC_Ordinary_Pop9_flag
	set_variable = {
		PRC_Pop9_Attitude = 10
	}
	set_variable = {
		PRC_Pop9_Influence = 32
	}
	set_country_flag = PRC_Ordinary_Pop10_flag
	set_variable = {
		PRC_Pop10_Attitude = 10
	}
	set_variable = {
		PRC_Pop10_Influence = 20
	}
	set_country_flag = PRC_Ordinary_Pop11_flag
	set_variable = {
		PRC_Pop11_Attitude = 10
	}
	set_variable = {
		PRC_Pop11_Influence = 32
	}
	set_country_flag = PRC_Marginalized_Pop12_flag
	set_variable = {
		PRC_Pop12_Attitude = 10
	}
	set_variable = {
		PRC_Pop12_Influence = 4
	}
	set_country_flag = PRC_Marginalized_Pop13_flag
	set_variable = {
		PRC_Pop13_Attitude = 10
	}
	set_variable = {
		PRC_Pop13_Influence = 8
	}
	set_country_flag = PRC_Marginalized_Pop14_flag
	set_variable = {
		PRC_Pop14_Attitude = 10
	}
	set_variable = {
		PRC_Pop14_Influence = 8
	}
	PRC_Pop_Update_effect = yes
}
PRC_Pop_addition_effect = {
	meta_effect = {
		text = {
			if = {
				limit = {
					check_variable = {
						var = PRC_Pop[PRC_Pop_Serial_Num1]_Influence
						value = 60
						compare = greater_than_or_equals
					}
				}
				set_temp_variable = { PRC_Pop_group_temp = 1 }
				set_country_flag = PRC_Major_Pop[PRC_Pop_temp_text]_flag
			}
			else_if = {
				limit = {
					check_variable = {
						var = PRC_Pop[PRC_Pop_Serial_Num1]_Influence
						value = 25
						compare = greater_than_or_equals
					}
					check_variable = {
						var = PRC_Pop[PRC_Pop_Serial_Num1]_Influence
						value = 60
						compare = less_than
					}
				}
				set_temp_variable = { PRC_Pop_group_temp = 2 }
				set_country_flag = PRC_Ordinary_Pop[PRC_Pop_temp_text]_flag
			}
			else_if = {
				limit = {
					check_variable = {
						var = PRC_Pop[PRC_Pop_Serial_Num1]_Influence
						value = 25
						compare = less_than
					}
				}
				set_temp_variable = { PRC_Pop_group_temp = 3 }
				set_country_flag = PRC_Marginalized_Pop[PRC_Pop_temp_text]_flag
			}
		}
		PRC_Pop_temp_text = "[?PRC_Pop_n_temp]"
	}	
	custom_effect_tooltip = PRC_Pop_addition_tt
	PRC_Pop_Update_effect = yes
}
PRC_Pop_removal_effect = {
	custom_effect_tooltip = PRC_Pop_removal_tt
	meta_effect = {
		text = {
			clr_country_flag = PRC_Major_Pop[PRC_Pop_temp_text]_flag
			clr_country_flag = PRC_Ordinary_Pop[PRC_Pop_temp_text]_flag
			clr_country_flag = PRC_Marginalized_Pop[PRC_Pop_temp_text]_flag
		}
		PRC_Pop_temp_text = "[?PRC_Pop_n_temp]"
	}	
	PRC_Pop_Update_effect = yes
}
PRC_Pop_attitude_effect = {
	custom_effect_tooltip = PRC_Pop_attitude_tt
	meta_effect = {
		text = {
			add_to_variable = {
				var = PRC_Pop[PRC_Pop_temp_text]_attitude
				value = PRC_Pop_a_temp
			}
		}
		PRC_Pop_temp_text = "[?PRC_Pop_n_temp]"
	}	
	PRC_Pop_Update_effect = yes
}
PRC_Pop_influence_effect = {
	custom_effect_tooltip = PRC_Pop_influcence_tt
	meta_effect = {
		text = {
			if = {
				limit = {
					check_variable = {
						var = PRC_Pop[PRC_Pop_temp_text]_Influence
						value = 60
						compare = greater_than_or_equals
					}
				}
				set_temp_variable = { PRC_Pop_group_temp1 = 1 }
			}
			else_if = {
				limit = {
					check_variable = {
						var = PRC_Pop[PRC_Pop_temp_text]_Influence
						value = 25
						compare = greater_than_or_equals
					}
					check_variable = {
						var = PRC_Pop[PRC_Pop_temp_text]_Influence
						value = 60
						compare = less_than
					}
				}
				set_temp_variable = { PRC_Pop_group_temp1 = 2 }
			}
			else_if = {
				limit = {
					check_variable = {
						var = PRC_Pop[PRC_Pop_temp_text]_Influence
						value = 25
						compare = less_than
					}
				}
				set_temp_variable = { PRC_Pop_group_temp1 = 3 }
			}




			add_to_variable = {
				var = PRC_Pop[PRC_Pop_temp_text]_Influence
				value = PRC_Pop_i_temp
			}




			if = {
				limit = {
					check_variable = {
						var = PRC_Pop[PRC_Pop_temp_text]_Influence
						value = 60
						compare = greater_than_or_equals
					}
					NOT = { has_country_flag = PRC_Major_Pop[PRC_Pop_temp_text]_flag }
				}
				set_country_flag = PRC_Major_Pop[PRC_Pop_temp_text]_flag
				clr_country_flag = PRC_Ordinary_Pop[PRC_Pop_temp_text]_flag
				clr_country_flag = PRC_Marginalized_Pop[PRC_Pop_temp_text]_flag
				set_temp_variable = { PRC_Pop_group_temp = 1 }
				custom_effect_tooltip = PRC_Pop_group_change_tt
			}
			else_if = {
				limit = {
					check_variable = {
						var = PRC_Pop[PRC_Pop_temp_text]_Influence
						value = 60
						compare = less_than
					}
					check_variable = {
						var = PRC_Pop[PRC_Pop_temp_text]_Influence
						value = 25
						compare = greater_than_or_equals
					}
					NOT = { has_country_flag = PRC_Ordinary_Pop[PRC_Pop_temp_text]_flag }
				}
				clr_country_flag = PRC_Major_Pop[PRC_Pop_temp_text]_flag
				set_country_flag = PRC_Ordinary_Pop[PRC_Pop_temp_text]_flag
				clr_country_flag = PRC_Marginalized_Pop[PRC_Pop_temp_text]_flag
				set_temp_variable = { PRC_Pop_group_temp = 2 }
				
			}
			else_if = {
				limit = {
					check_variable = {
						var = PRC_Pop[PRC_Pop_temp_text]_Influence
						value = 25
						compare = less_than
					}
				    NOT = { has_country_flag = PRC_Marginalized_Pop[PRC_Pop_temp_text]_flag }
				}
				clr_country_flag = PRC_Major_Pop[PRC_Pop_temp_text]_flag
				clr_country_flag = PRC_Ordinary_Pop[PRC_Pop_temp_text]_flag
				set_country_flag = PRC_Marginalized_Pop[PRC_Pop_temp_text]_flag
				set_temp_variable = { PRC_Pop_group_temp = 3 }
				custom_effect_tooltip = PRC_Pop_group_change_tt
			}

			if = {
				limit = {
					NOT = {
						check_variable = { PRC_Pop_group_temp1 = PRC_Pop_group_temp }
					}
				}
				custom_effect_tooltip = PRC_Pop_group_change_tt
			}
		}
		PRC_Pop_temp_text = "[?PRC_Pop_n_temp]"
	}
	PRC_Pop_Update_effect = yes
}